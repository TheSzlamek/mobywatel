<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>mDowód — mock (SAMPLE)</title>
<style>
/* ===================== RESET & BASE ===================== */
:root{
  --bg:#f4f6fb;
  --card:#fff;
  --muted:#6b7280;
  --accent:#1f6feb;
  --accent-soft:#eaf3ff;
  --success:#2e7d32;
  --radius:14px;
  --shadow: 0 8px 24px rgba(16,24,40,0.06);
  --maxw:420px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  background:var(--bg);
  color:#0f1724;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.35;
}
.container{max-width:var(--maxw);margin:0 auto;padding-left:8px;padding-right:8px;}
.row{display:flex;align-items:center;gap:12px;}
.center{text-align:center;}
.small{font-size:13px;color:var(--muted);}

/* ===================== HEADER ===================== */
.header{
  position:sticky;top:0;z-index:40;
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 8px;background:var(--card);border-bottom:1px solid rgba(15,23,42,0.04)
}
.header .left{display:flex;align-items:center;gap:10px}
.header .back{display:flex;align-items:center;gap:8px;color:var(--accent);cursor:pointer;font-weight:700}
.header h1{margin:0;font-size:17px;font-weight:700}
.header .help{width:34px;height:34px;display:flex;align-items:center;justify-content:center;border-radius:50%}

/* clock */
.clock{ text-align:center;color:var(--muted);font-size:13px;margin:12px 0; }

/* ===================== TOP CARD (mock of ID) ===================== */
.card-top{
  background:var(--card);
  border-radius:var(--radius);
  margin:0 8px;
  box-shadow:var(--shadow);
  overflow:hidden;
  border:1px solid rgba(16,24,40,0.03);
  position:relative;
}

/* watermark to mark sample */
.card-top::after{
  content:"SAMPLE — DO NOT USE";
  position:absolute;left:-8%;top:44%;
  width:116%;text-align:center;
  font-weight:800;font-size:14px;color:rgba(17,24,39,0.06);
  transform:rotate(-16deg);
  pointer-events:none;
}

/* plate area */
.card-plate{ display:flex; gap:18px; padding:18px; position:relative;
  /* background plate image - your file plate.png should be present */
  background-image: url('plate.png');
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
}

/* left column */
.card-left{width:136px;flex-shrink:0;display:flex;flex-direction:column;align-items:flex-start}
.photo { width:104px;height:124px;border-radius:8px;overflow:hidden;border:1px solid rgba(16,24,40,0.06);
  background: linear-gradient(180deg,#fff,#f0f6ff); display:flex;align-items:center;justify-content:center; }
.photo img{width:100%;height:100%;object-fit:cover;display:block}

/* emblems */
.emblems{margin-top:10px;display:flex;flex-direction:column;gap:8px}
.flag{width:72px;height:44px;border-radius:6px;overflow:hidden}
.eagle-row{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:12px}
.eagle-row img{height:18px}

/* right column */
.card-right{flex:1;padding-right:6px;display:flex;flex-direction:column;justify-content:center}
.card-right .name{font-size:20px;font-weight:800;margin-bottom:2px;letter-spacing:0.2px}
.card-right .subtitle{font-size:13px;color:var(--muted);margin-bottom:8px}
.card-right .item{margin:6px 0}
.pesel{font-size:18px;font-weight:800;margin-top:6px}

/* status area */
.status-bar{display:flex;align-items:center;gap:12px;padding:12px 16px;border-top:1px solid rgba(16,24,40,0.03);
  background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(255,255,255,0.98));}
.status-dot{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid var(--success);color:var(--success)}
.status-text{color:var(--success);font-weight:800}

/* ===================== UPLOAD CONTROLS ===================== */
.upload-row{margin:12px 8px;display:flex;gap:12px;align-items:center;justify-content:space-between}
.upload-area{
  flex:1;border-radius:12px;border:1px dashed rgba(16,24,40,0.06);background:transparent;padding:10px;display:flex;align-items:center;gap:10px;
}
.upload-area.drag{background:rgba(31,111,235,0.02);border-color:rgba(31,111,235,0.18)}
.upload-area input{display:none}
.btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
.btn.secondary{background:var(--card);color:var(--accent);border:1px solid rgba(31,111,235,0.12)}

/* ===================== SHORTCUTS (circle icons) ===================== */
.shortcuts{
  display:flex;justify-content:space-around;gap:8px;margin:14px 8px;padding:12px 8px;
  background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
  align-items:center;flex-wrap:wrap;
}
.shortcut{width:86px;display:flex;flex-direction:column;align-items:center;gap:8px;text-decoration:none;color:inherit;cursor:pointer}
.icon-circle{width:56px;height:56px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
.shortcut img{width:28px;height:28px}
.shortcut .label{font-size:13px;color:var(--muted);text-align:center;line-height:1.05}

/* ===================== INFO CARD (PCR + fields) ===================== */
.info-card{
  margin:14px 8px 160px; /* leave space for bottom nav */
  background:var(--card);border-radius:16px;box-shadow:var(--shadow);overflow:hidden;border:1px solid rgba(16,24,40,0.03);
}
.info-inner{padding:18px}
.info-row{padding:14px 6px;display:flex;justify-content:space-between;align-items:center;gap:12px;border-bottom:1px solid rgba(16,24,40,0.04)}
.info-row:last-child{border-bottom:none}
.info-left{max-width:68%}
.info-label{font-size:15px;color:var(--muted);margin-bottom:10px}
.info-value{font-weight:900;font-size:34px;line-height:1;letter-spacing:0.3px}
.info-value.small{font-size:20px;font-weight:800}
.copy-pill{background:var(--accent-soft);color:var(--accent);border:none;padding:8px 14px;border-radius:18px;font-weight:700;cursor:pointer}
.copy-pill:active{transform:scale(.98)}

/* bottom nav */
.bottom-nav{position:fixed;left:0;right:0;bottom:0;display:flex;justify-content:space-around;align-items:center;gap:8px;padding:8px 8px;background:var(--card);border-top:1px solid rgba(16,24,40,0.03);box-shadow:0 -6px 18px rgba(16,24,40,0.03);z-index:50}
.bottom-item{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted);text-decoration:none}
.bottom-item.active{color:var(--accent)}
.bottom-item img{width:24px;height:24px;margin-bottom:6px}

/* toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:140px;background:rgba(17,24,39,0.95);color:#fff;padding:10px 14px;border-radius:10px;font-size:14px;opacity:0;pointer-events:none;transition:opacity .15s,bottom .15s;z-index:999}
.toast.show{opacity:1;bottom:160px;pointer-events:auto}

/* responsive tweaks */
@media (max-width:420px){
  .info-value{font-size:30px}
  .icon-circle{width:50px;height:50px}
  .shortcut{width:76px}
  .photo{width:94px;height:112px}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header container" role="banner" aria-label="Górny pasek">
  <div class="left">
    <div class="back" onclick="goBack()" role="button" aria-label="Wróć">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M15 18l-6-6 6-6" stroke="#1f6feb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Wróć</span>
    </div>
  </div>
  <h1>mDowód</h1>
  <div class="help" title="Pomoc" aria-hidden="true">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="#0f1724" stroke-opacity="0.6" stroke-width="1"/><path d="M9.5 9a2.5 2.5 0 1 1 5 0c0 2-3 2.25-3 4" stroke="#0f1724" stroke-opacity="0.6" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </div>
</header>

<!-- CLOCK -->
<div id="clock" class="clock container">Czas: --:--:-- --.--.----</div>

<!-- TOP CARD -->
<section class="card-top container" aria-label="Karta dowodu">
  <div style="position:relative;">
    <div class="card-plate">
      <div class="card-left">
        <figure class="photo" aria-hidden="true">
          <!-- photo initially loads from xddddd.png; will be replaced when user uploads -->
          <img id="photoImg" src="xddddd.png" alt="Zdjęcie testowe (podmień xddddd.png)"/>
        </figure>

        <div class="emblems">
          <div class="flag" aria-hidden="true">
            <img src="flag.webp" alt="Flaga (TEST)" style="width:100%;height:100%;object-fit:cover;display:block">
          </div>

          <div class="eagle-row">
            <img src="eagle.gif" alt="Godło (TEST)">
            <div class="small">Rzeczpospolita<br>Polska</div>
          </div>
        </div>
      </div>

      <div class="card-right" aria-hidden="true">
        <div class="item">
          <div id="givenName" class="name">TEST IMIĘ</div>
          <div class="subtitle">Imię (imiona)</div>
        </div>

        <div class="item">
          <div id="familyName" class="name">TEST NAZWISKO</div>
          <div class="subtitle">Nazwisko</div>
        </div>

        <div class="item">
          <div class="name">POLSKIE</div>
          <div class="subtitle">Obywatelstwo</div>
        </div>

        <div class="item">
          <div id="birthDate" class="name">01.01.2000</div>
          <div class="subtitle">Data urodzenia</div>
        </div>

        <div class="item pesel" id="peselField">00000000000
          <div class="subtitle" style="font-weight:400">Numer PESEL</div>
        </div>
      </div>
    </div>

    <!-- status area with "valid" icon -->
    <div class="status-bar">
      <div class="status-dot" aria-hidden="true">
        <img src="valid.png" alt="Valid" style="width:22px;height:22px">
      </div>
      <div class="status-text">Dokument ważny</div>
    </div>

    <div style="position:absolute;left:12px;top:10px;opacity:0.06;font-weight:900;font-size:13px;transform:rotate(-6deg);pointer-events:none;">
      SAMPLE — DO NOT USE
    </div>
  </div>
</section>

<!-- UPLOAD CONTROLS -->
<div class="upload-row container">
  <label class="upload-area" id="dropArea">
    <input id="fileInput" type="file" accept="image/*">
    <div style="display:flex;flex-direction:column;gap:6px;">
      <strong>Dodaj zdjęcie</strong>
      <div class="small">Przeciągnij upuść lub kliknij, by wybrać plik. Po wgraniu zdjęcie będzie automatycznie przycięte i zamienione na czarno-białe.</div>
    </div>
  </label>
  <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
    <button id="clearBtn" class="btn secondary">Usuń zdjęcie</button>
    <button id="saveBtn" class="btn">Zapisz (test)</button>
  </div>
</div>

<!-- SHORTCUTS -->
<nav class="shortcuts container" role="navigation" aria-label="Skróty">
  <a class="shortcut" href="https://google.com" target="_blank" rel="noreferrer">
    <div class="icon-circle" aria-hidden="true"><img src="confirm.png" alt="Potwierdź"></div>
    <div class="label">Potwierdź<br>swoje dane</div>
  </a>

  <a class="shortcut" href="https://google.com" target="_blank" rel="noreferrer">
    <div class="icon-circle" aria-hidden="true"><img src="card.png" alt="Dane"></div>
    <div class="label">Dane dowodu<br>osobistego</div>
  </a>

  <a class="shortcut" href="https://google.com" target="_blank" rel="noreferrer">
    <div class="icon-circle" aria-hidden="true"><img src="lock.png" alt="Zastrzeż"></div>
    <div class="label">Zastrzeż<br>PESEL</div>
  </a>

  <a class="shortcut" href="https://google.com" target="_blank" rel="noreferrer">
    <div class="icon-circle" aria-hidden="true"><img src="more.png" alt="Więcej"></div>
    <div class="label">Pozostałe<br>skróty</div>
  </a>
</nav>

<!-- INFO CARD -->
<section class="info-card container" aria-label="Szczegóły dokumentu">
  <div class="info-inner">
    <div class="info-row" style="align-items:flex-start;">
      <div class="info-left">
        <div class="info-label">Seria i numer</div>
        <div id="pcrValue" class="info-value">PCR 154316</div>
      </div>
      <div><button id="copyBtn" class="copy-pill" title="Kopiuj serię">Kopiuj</button></div>
    </div>

    <div class="info-row">
      <div class="info-left">
        <div class="info-label">Termin ważności</div>
        <div class="info-value small">08.01.2035</div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-left">
        <div class="info-label">Data wydania</div>
        <div class="info-value small">07.01.2025</div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-left">
        <div class="info-label">Imię ojca</div>
        <div class="info-value small">KAROL</div>
      </div>
    </div>

    <div class="info-row">
      <div class="info-left">
        <div class="info-label">Imię matki</div>
        <div class="info-value small">ANDŻELIKA</div>
      </div>
    </div>
  </div>
</section>

<!-- toast -->
<div id="toast" class="toast" role="status" aria-live="polite">Skopiowano</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav" role="navigation" aria-label="Dolna nawigacja">
  <a class="bottom-item active" href="#"><img src="confirm.png" alt=""><div>Pulpit</div></a>
  <a class="bottom-item" href="#"><img src="card.png" alt=""><div>Dokumenty</div></a>
  <a class="bottom-item" href="#"><img src="lock.png" alt=""><div>Usługi</div></a>
  <a class="bottom-item" href="#"><img src="more.png" alt=""><div>Kod QR</div></a>
  <a class="bottom-item" href="#"><img src="more.png" alt=""><div>Więcej</div></a>
</nav>

<script>
/* ======= CLOCK ======= */
function updateClock(){
  const now = new Date();
  const pad = n => n.toString().padStart(2,'0');
  const timeStr = pad(now.getHours()) + ":" + pad(now.getMinutes()) + ":" + pad(now.getSeconds())
    + " " + pad(now.getDate()) + "." + pad(now.getMonth()+1) + "." + now.getFullYear();
  document.getElementById('clock').textContent = "Czas: " + timeStr;
}
setInterval(updateClock,1000);
updateClock();

/* ======= NAV BACK ======= */
function goBack(){
  if(history.length>1) history.back();
  else alert('Brak historii (test).');
}

/* ======= TOAST ======= */
const toast = document.getElementById('toast');
let toastTimer = null;
function showToast(msg){
  toast.textContent = msg;
  toast.classList.add('show');
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> toast.classList.remove('show'), 1800);
}

/* ======= COPY PCR ======= */
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  const text = document.getElementById('pcrValue').innerText.trim();
  try {
    await navigator.clipboard.writeText(text);
    showToast('Skopiowano: ' + text);
  } catch(e) {
    showToast('Kopiowanie nieudane');
  }
});

/* ======= ADJUST BOTTOM MARGIN ======= */
function adjustBottomSpacing(){
  const bottom = document.querySelector('.bottom-nav');
  if(!bottom) return;
  const h = bottom.offsetHeight;
  const info = document.querySelector('.info-card');
  if(info) info.style.marginBottom = (h + 40) + 'px';
}
window.addEventListener('load', adjustBottomSpacing);
window.addEventListener('resize', adjustBottomSpacing);

/* ======= UPLOAD, CROP, GRAYSCALE =======
   - target ratio: width:height = 5:6 (approx like photo area)
   - target pixel size: 500x600 (kept for quality), final preview scaled by CSS
   - on upload, process with canvas: center-crop, resize, convert to grayscale, produce dataURL
=================================================*/
const fileInput = document.getElementById('fileInput');
const dropArea = document.getElementById('dropArea');
const photoImg = document.getElementById('photoImg');
const clearBtn = document.getElementById('clearBtn');

function preventDefaults(e){ e.preventDefault(); e.stopPropagation(); }
['dragenter','dragover','dragleave','drop'].forEach(evt => {
  dropArea.addEventListener(evt, preventDefaults, false);
});
dropArea.addEventListener('dragover', ()=> dropArea.classList.add('drag'), false);
dropArea.addEventListener('dragleave', ()=> dropArea.classList.remove('drag'), false);
dropArea.addEventListener('drop', handleDrop, false);

function handleDrop(e){
  dropArea.classList.remove('drag');
  const dt = e.dataTransfer;
  const files = dt.files;
  if(files && files.length) handleFile(files[0]);
}

fileInput.addEventListener('change', (e)=>{
  if(e.target.files && e.target.files[0]) handleFile(e.target.files[0]);
});

clearBtn.addEventListener('click', ()=>{
  // reset to default image file xddddd.png if exists
  photoImg.src = 'xddddd.png';
  showToast('Zdjęcie usunięte (test).');
});

async function handleFile(file){
  if(!file.type.startsWith('image/')) { showToast('Wybierz plik obrazu.'); return; }
  const img = await loadImageFromFile(file);
  const processed = processImageToGrayscaleAndCrop(img, 500, 600); // 5:6 ratio
  photoImg.src = processed;
  showToast('Zdjęcie wgrane i przetworzone.');
}

// load image to HTMLImageElement
function loadImageFromFile(file){
  return new Promise((res, rej)=>{
    const fr = new FileReader();
    fr.onload = () => {
      const img = new Image();
      img.onload = () => res(img);
      img.onerror = rej;
      img.src = fr.result;
    };
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
}

// process: center-crop to ratio, resize, grayscale -> return dataURL
function processImageToGrayscaleAndCrop(img, targetW, targetH){
  // determine source crop to match target ratio
  const srcW = img.naturalWidth;
  const srcH = img.naturalHeight;
  const targetRatio = targetW/targetH;
  let sx, sy, sWidth, sHeight;

  const srcRatio = srcW / srcH;
  if(srcRatio > targetRatio){
    // source is wider -> cut sides
    sHeight = srcH;
    sWidth = Math.round(srcH * targetRatio);
    sx = Math.round((srcW - sWidth) / 2);
    sy = 0;
  } else {
    // source is taller -> cut top/bottom
    sWidth = srcW;
    sHeight = Math.round(srcW / targetRatio);
    sx = 0;
    sy = Math.round((srcH - sHeight) / 2);
  }

  // create canvas and draw
  const canvas = document.createElement('canvas');
  canvas.width = targetW;
  canvas.height = targetH;
  const ctx = canvas.getContext('2d');

  // draw cropped area into canvas resized
  ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, targetW, targetH);

  // get image data, convert to grayscale
  const imageData = ctx.getImageData(0,0,targetW,targetH);
  const data = imageData.data;
  for(let i=0;i<data.length;i+=4){
    // luminance formula
    const r = data[i], g = data[i+1], b = data[i+2];
    const l = Math.round(0.299*r + 0.587*g + 0.114*b);
    data[i] = data[i+1] = data[i+2] = l;
    // keep alpha
  }
  ctx.putImageData(imageData, 0, 0);

  // optional subtle vignette or border could be added here if desired

  // return data URL (png)
  return canvas.toDataURL('image/png');
}

/* ======= OPTIONAL: saveBtn (demo) ======= */
document.getElementById('saveBtn').addEventListener('click', ()=>{
  showToast('Zapis (test) wykonany — brak zapisu na serwerze.');
});

/* Accessibility: enable keyboard activation on shortcuts */
document.querySelectorAll('.shortcut').forEach(el=>{
  el.setAttribute('tabindex', '0');
  el.addEventListener('keydown', e=>{
    if(e.key === 'Enter' || e.key === ' ') el.click();
  });
});

</script>
</body>
</html>

